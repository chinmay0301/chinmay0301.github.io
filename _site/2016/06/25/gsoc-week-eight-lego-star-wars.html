<!DOCTYPE html>
<html>

  <head>
    <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>GSoC Week Eight - LEGO Star Wars!</title>
  <meta name="description" content="My MozLondon trip ended on a high, when Armen gifted me a super cool Star Wars Rebels LEGO kit! I spent a complete day this week making the starships, and th...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://chinmay0301.github.io/2016/06/25/gsoc-week-eight-lego-star-wars.html">
  <link rel="alternate" type="application/rss+xml" title="Chinmay Talegaonkar" href="http://chinmay0301.github.io/feed.xml">
</head>

    

    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>GSoC Week Eight - LEGO Star Wars! | Chinmay Talegaonkar</title>
<meta name="generator" content="Jekyll v3.8.4" />
<meta property="og:title" content="GSoC Week Eight - LEGO Star Wars!" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="My MozLondon trip ended on a high, when Armen gifted me a super cool Star Wars Rebels LEGO kit! I spent a complete day this week making the starships, and they are brilliant to say the least! This is what the Darth Vader ship looks like." />
<meta property="og:description" content="My MozLondon trip ended on a high, when Armen gifted me a super cool Star Wars Rebels LEGO kit! I spent a complete day this week making the starships, and they are brilliant to say the least! This is what the Darth Vader ship looks like." />
<link rel="canonical" href="http://chinmay0301.github.io/2016/06/25/gsoc-week-eight-lego-star-wars.html" />
<meta property="og:url" content="http://chinmay0301.github.io/2016/06/25/gsoc-week-eight-lego-star-wars.html" />
<meta property="og:site_name" content="Chinmay Talegaonkar" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-06-25T04:39:55+05:30" />
<script type="application/ld+json">
{"url":"http://chinmay0301.github.io/2016/06/25/gsoc-week-eight-lego-star-wars.html","headline":"GSoC Week Eight - LEGO Star Wars!","dateModified":"2016-06-25T04:39:55+05:30","datePublished":"2016-06-25T04:39:55+05:30","description":"My MozLondon trip ended on a high, when Armen gifted me a super cool Star Wars Rebels LEGO kit! I spent a complete day this week making the starships, and they are brilliant to say the least! This is what the Darth Vader ship looks like.","mainEntityOfPage":{"@type":"WebPage","@id":"http://chinmay0301.github.io/2016/06/25/gsoc-week-eight-lego-star-wars.html"},"@type":"BlogPosting","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    
      <meta content="https://avatars1.githubusercontent.com/u/8805240" property="og:image" />
    
  </head>

  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Chinmay Talegaonkar</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
          <a class="page-link" href="/archive.html">Blog</a>
          
        
          
          <a class="page-link" href="/cv/">CV</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="/research/">Research</a>
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">GSoC Week Eight - LEGO Star Wars!</h1>
    <p class="post-meta"><time datetime="2016-06-25T04:39:55+05:30" itemprop="datePublished">Jun 25, 2016</time> </p>
    

  </header>

  <div class="post-content" itemprop="articleBody">
    <p>My MozLondon trip ended on a high, when Armen gifted me a super cool Star Wars Rebels LEGO kit! I spent a complete day this week making the starships, and they are brilliant to say the least! This is what the Darth Vader ship looks like.</p>

<p><img src="http://chinmay0301.github.io/assets/lego.jpg" alt="lego" /></p>

<p>So I’m now having to do some in-tree work. It was an eventful week full of Action Tasks.</p>

<h2 id="why-not-pulse-actions">Why not Pulse Actions?</h2>

<p>So the original plan to schedule Treeherder jobs was completely using <a href="https://github.com/mozilla/pulse_actions">pulse_actions</a>, following an approach similar to Buildbot jobs. There are several problems here. TaskCluster has several authentication steps, and we needed to go through an RRA before I could be granted credentials to schedule TaskCluster jobs in Treeherder via Pulse Actions. TaskCluster is going through a lot of changes and it would be impossible for pulse_actions to keep up with this.
Most importantly, Dustin had done most of what I was doing in pulse_actions in-tree. The code he’d written is more effective since it was optimizing the task graph removing redundant steps.</p>

<p>Hence we decided NOT to go ahead with <a href="https://github.com/mozilla/mozilla_ci_tools/pull/486">this</a>. Nevertheless, it was fun writing a basic version of the code as it involved some graph theory. As you can see in the last blogpost, I did succeed in scheduling jobs using this approach.</p>

<h2 id="what-are-action-tasks">What are Action Tasks?</h2>

<p>Action Tasks are going to be new types of jobs, which will run a new <a href="https://dxr.mozilla.org/mozilla-central/source/mach">mach command</a> and schedule the jobs specified in the mach command’s parameter list. When a user clicks on “Add New Jobs”, a pulse message will be sent down to pulse_actions, which in turn will schedule an Action Task in that push on Treeherder.
This action task runs the new mach command and uses the in-tree code to schedule the required jobs. This is a better approach for a few reasons:</p>

<ul>
  <li>The action task will have <strong>all the logs regarding “Add New Jobs” failures</strong>. There is no need to look at the PaperTrail in pulse_actions as long as the Action Task has been scheduled.</li>
  <li>The action task <strong>reuses Dustin’s in-tree work</strong> and will be <strong>easier to maintain</strong>.</li>
  <li>The action task <strong>gives users proper feedback</strong>. A failed Action Task would mean that “Add New Jobs” has failed. In the current model, the user does not receive any feedback and is forced to file a bug, not knowing what happened.</li>
  <li>The <strong>asynchronous element is slowly going away</strong>. Since we just have one job to schedule now, once Treeherder gets its TaskCluster authentication, we could directly schedule Action Tasks using Treeherder. This would remove the need of asynchronous Pulse messages for “Add New Jobs” and slowly make “Add New Jobs” completely synchronous.</li>
</ul>

<p>The major disadvantage of action tasks is the non-parallelism with the approach for Buildbot jobs. However, since Buildbot jobs will soon be TaskCluster jobs, it makes sense to go forward with Action Tasks.</p>

<h2 id="are-we-going-to-kill-pulse-actions">Are we going to kill Pulse Actions?</h2>

<p>No, not yet. A lot of features rely on Pulse Actions. We will be using pulse_actions to schedule the Action Tasks for now. Since Treeherder is receiving a TaskCluster authentication soon, pulse_actions may not be used in the future to schedule Action Tasks, and we would do it using Treeherder directly.
We might not need pulse_actions at all in the future once Buildbot jobs have been removed completely. However, this could take a significant amount of time.</p>

<h2 id="progress-with-action-tasks">Progress with Action Tasks</h2>

<p>I’ve had an excellent week with respect to programming action tasks. It started by filing <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1281062">Bug 1281062</a>. As you can see, I’ve added patches. Yes, we have our first green action tasks! :)</p>

<p>So I started by creating a new mach command, <code class="highlighter-rouge">mach taskgraph action-task</code>. Here is what a sample command looks like -</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./mach taskgraph action-task --task-labels="TaskLabel==A-JT3sTNQMSvayONPiHU6A,TaskLabel==AWMGHageQh-L_nkBPsQOvA" --decision-id="TADoGLV5RUWQYivg1ReyTw"
</code></pre></div></div>

<p>There are two parameters here, the very same parameters I fetch from Treeherder. The gecko decision task ID and a comma separated list of Task Labels for that decision id. I am sending exactly these two parameters down the Pulse message.</p>

<p>This mach command downloads the corresponding full-tasks-graph file and generates a <code class="highlighter-rouge">TaskGraph</code> object using it. (<code class="highlighter-rouge">TaskGraph</code> defined <a href="https://dxr.mozilla.org/mozilla-central/source/taskcluster/taskgraph/types.py#44">here</a>). This then passes through the in-tree code to generate aritifacts, optimize the task graph and schedule the tasks.</p>

<p>The second part of the patch was creating an action task definition and creating it as an artifact in the decision task. This was a bit challenging, since there are a lot of contraints on the task definition schema. I did succeed after a few iterations, and I could use <code class="highlighter-rouge">action.yml</code> to schedule an action task in Treeherder.</p>

<p>The first few action tasks failed due to a timestamps issue. I’m updating all timestamps in-tree now, (in the action task mach command). I soon had my first green action task :D</p>

<p><img src="http://chinmay0301.github.io/assets/action.png" alt="action" /></p>

<p>In the above picture, <code class="highlighter-rouge">tc-M(dt4)</code> is the job I passed in the parameters, and it was successfully scheduled. Unfortunately, <code class="highlighter-rouge">optimize.py</code> hasn’t done its magic as taskcluster-images were also scheduled. I might need to dig into what’s wrong, but atleast we have an awesome start! <a href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=88f8d3edac627665a2dc6df5294ccd53cb53621c">This</a> is the push on Treeherder. We’ve tracked the task <a href="https://tools.taskcluster.net/task-inspector/#dxZ73-meQ-WR4WIghphVpg/0">here</a>.</p>

<h2 id="other-news">Other News</h2>

<p>It’s raining heavily in Mumbai all day, so I’m pretty much indoors. I visited the Facebook Mumbai office and it was really cool! We have started a new <a href="http://wncc-iitb.org/soc/">Seasons of Code</a> project in our club named <a href="https://github.com/ranveeraggarwal/rattlesnake">Rattlesnake</a> to teach people Python. I might do the same tasks in Perl!</p>

<h2 id="coming-up">Coming Up</h2>

<p>We might have to merge the Treeherder <a href="https://github.com/mozilla/treeherder/pull/1490">Pull Request</a> putting some UI restrictions to help <a href="https://github.com/MikeLing">Mike Ling</a> continue with his GSoC project. I hope to complete my action tasks patch and write a function in MozCI / Pulse Actions to schedule Action Tasks on receiving pulse messages.</p>

  </div>

</article>



      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Chinmay Talegaonkar</li>
          <li><a href="mailto:chinmay0301@gmail.com">chinmay0301@gmail.com</a></li>
          <li><a href="mailto:chinmay0301@iitb.ac.in">chinmay0301@iitb.ac.in</a></li>
        </ul>
      </div>
      <div class="footer-col footer-col-1">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/chinmay0301"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">chinmay0301</span></a>

          </li>
          
          
          
          <li>
            <a href="https://www.linkedin.com/in/chinmay0301"><span class="icon icon--linkedin"><svg  x="0px" y="0px" width="16px" height="16px" viewBox="0 50 512 512" style="enable-background:new 0 0 90 90;" xml:space="preserve">
<g>
    <path fill="#828282" d="M150.65,100.682c0,27.992-22.508,50.683-50.273,50.683c-27.765,0-50.273-22.691-50.273-50.683
    C50.104,72.691,72.612,50,100.377,50C128.143,50,150.65,72.691,150.65,100.682z M143.294,187.333H58.277V462h85.017V187.333z
    M279.195,187.333h-81.541V462h81.541c0,0,0-101.877,0-144.181c0-38.624,17.779-61.615,51.807-61.615
    c31.268,0,46.289,22.071,46.289,61.615c0,39.545,0,144.181,0,144.181h84.605c0,0,0-100.344,0-173.915
    s-41.689-109.131-99.934-109.131s-82.768,45.369-82.768,45.369V187.333z"/>
</g>
</svg></span><span class="username">&nbsp;Chinmay Talegaonkar</span></a>

          </li>
          
        </ul>
      </div>
      <div class="footer-col footer-col-4">
        <!-- <p></p> -->
        <ul class="social-media-list">
        
        </ul>
      </div>
      
      
      
    </div>

  </div>

</footer>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-89391111-1', 'auto');
  ga('send', 'pageview');

</script>
    <script id="dsq-count-scr" src="//http-martiansideofthemoon-github-io.disqus.com/count.js" async></script>
  </body>

</html>
